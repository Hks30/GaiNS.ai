{% extends 'base.html' %}
{% load static %}
{% block content %}
  <title>Community Forum</title>
    <!-- Header 2 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="{% url 'community' %}">GaiNS Community</a>
    </nav>
  </header>
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-8">
  
        <!-- Question 1 Card -->
        <div class="card mb-3">
          <div class="card-body">
            <h4 class="card-title">What are some effective exercises to build muscle mass?</h4>
            <p class="card-text">1 days ago | 10 answers</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center">
                <img src="profile-pic.jpg" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
                <span class="username">Howard Hogan</span>
              </div>
              <div>
                <button class="btn btn-primary btn-sm" onclick="toggleWriteAnswer('answer1')">Write</button>
                <button class="btn btn-secondary btn-sm ml-2" onclick="togglePin('question1')">
                  <i id="pinIcon_question1" class="fas fa-thumbtack"></i> 
                </button>
                <button class="btn btn-danger btn-sm ml-2" onclick="toggleDelete('question1')">
                  <i class="fas fa-times-circle"></i> 
                </button>
              </div>
            </div>
            <div class="write-answer mt-3" id="answer1" style="display: none;">
              <textarea class="form-control" rows="3" placeholder="Write your answer here"></textarea>
              <button class="btn btn-success mt-2" onclick="submitAnswer('answer1')">Submit</button>
            </div>
            <div id="submittedAnswers1" class="submitted-answers mt-3"></div>
          </div>
        </div>
        <!-- End Question 1 Card -->
  
        <!-- Question 2 Card -->
        <div class="card mb-3">
          <div class="card-body">
            <h4 class="card-title">How can I improve my flexibility for better performance in workouts?</h4>
            <p class="card-text">2 days ago | 2 answers</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center">
                <img src="profile-pic.jpg" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
                <span class="username">Johan Pritchel</span>
              </div>
              <div>
                <button class="btn btn-primary btn-sm" onclick="toggleWriteAnswer('answer2')">Write</button>
                <button class="btn btn-secondary btn-sm ml-2" onclick="togglePin('question2')">
                  <i id="pinIcon_question2" class="fas fa-thumbtack"></i> 
                </button>
                <button class="btn btn-danger btn-sm ml-2" onclick="toggleDelete('question2')">
                  <i class="fas fa-times-circle"></i> 
                </button>
              </div>
            </div>
            <div class="write-answer mt-3" id="answer2" style="display: none;">
              <textarea class="form-control" rows="3" placeholder="Write your answer here"></textarea>
              <button class="btn btn-success mt-2" onclick="submitAnswer('answer2')">Submit</button>
            </div>
            <div id="submittedAnswers2" class="submitted-answers mt-3"></div>
          </div>
        </div>
        <!-- End Question 2 Card -->
  
        <!-- Question 3 Card -->
        <div class="card mb-3">
          <div class="card-body">
            <h4 class="card-title">What is the best way to lose belly fat?</h4>
            <p class="card-text">1 days ago | 1 answers</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center">
                <img src="profile-pic.jpg" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
                <span class="username">Mitchell Johnson</span>
              </div>
              <div>
                <button class="btn btn-primary btn-sm" onclick="toggleWriteAnswer('answer3')">Write</button>
                <button class="btn btn-secondary btn-sm ml-2" onclick="togglePin('question3')">
                  <i id="pinIcon_question3" class="fas fa-thumbtack"></i> 
                </button>
                <button class="btn btn-danger btn-sm ml-2" onclick="toggleDelete('question3')">
                  <i class="fas fa-times-circle"></i> 
                </button>
              </div>
            </div>
            <div class="write-answer mt-3" id="answer3" style="display: none;">
              <textarea class="form-control" rows="3" placeholder="Write your answer here"></textarea>
              <button class="btn btn-success mt-2" onclick="submitAnswer('answer3')">Submit</button>
            </div>
            <div id="submittedAnswers3" class="submitted-answers mt-3"></div>
          </div>
        </div>
        <!-- End Question 3 Card -->
  
        <!-- Repeat similar card structure for other questions -->
  
      </div>
  
      <div class="col-md-4">
        <div class="card mb-3">
          <div class="card-body">
            <h4 class="card-title">Top Contributors</h4>
            <div class="contributor mb-2">
              <img src="profile-pic.jpg" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
              <span class="username">Johan Pritchel</span>
              <span class="badge badge-success ml-2">Active</span>
            </div>
            <div class="contributor mb-2">
              <img src="profile-pic.jpg" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
              <span class="username">Howard Hogan</span>
              <span class="badge badge-danger ml-2">Inactive</span>
            </div>
            <div class="contributor mb-2">
              <img src="profile-pic.jpg" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
              <span class="username">Mitchell Johnson</span>
              <span class="badge badge-success ml-2">Active</span>
            </div>
          </div>
        </div>
  
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Top Questions</h4>
            <ul class="list-group list-group-flush">
              <li class="list-group-item"><a href="#">What are some effective exercises to build muscle mass?</a></li>
              <li class="list-group-item"><a href="#">How can I improve my flexibility for better performance in workouts?</a></li>
              <li class="list-group-item"><a href="#">What is the best way to lose belly fat?</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    window.onload = function() {
        loadPinnedQuestions();
        loadPreviousAnswers();
        sortQuestions();
    };

    // Load previous answers on page load
    window.onload = function() {
        loadPreviousAnswers();
    };

    // Load previous answers from localStorage
    function loadPreviousAnswers() {
      for (let i = 1; i <= 3; i++) {
        let storedAnswers = localStorage.getItem("answers" + i);
        if (storedAnswers) {
          let submittedAnswersContainer = document.getElementById("submittedAnswers" + i);
          let answers = JSON.parse(storedAnswers);
          answers.forEach(function(answer) {
            let newAnswer = document.createElement("div");
            newAnswer.classList.add("submitted-answer");
            newAnswer.innerHTML = "<p><strong>Your Answer:</strong> " + answer + "</p>";
            submittedAnswersContainer.appendChild(newAnswer);
          });
        }
      }
    }
    function toggleWriteAnswer(answerId) {
      var answerDiv = document.getElementById(answerId);
      if (answerDiv.style.display === "none") {
        answerDiv.style.display = "block";
      } else {
        answerDiv.style.display = "none";
      }
    }
    // Function to submit an answer
    function submitAnswer(answerId) {
      var answerText = document.querySelector("#" + answerId + " textarea").value.trim();
      // Check if the answer is not empty
      if (answerText === '') {
        alert('Please write the answer.');
        return;
      }
      var submittedAnswersContainer = document.getElementById("submittedAnswers" + answerId.slice(-1));
      var newAnswerId = "answer" + answerId.slice(-1) + "_" + Date.now(); // Unique ID for each answer
      var newAnswer = document.createElement("div");
      newAnswer.setAttribute("id", newAnswerId)
      newAnswer.classList.add("submitted-answer");
      newAnswer.innerHTML = "<p><strong>Your Answer:</strong> " + answerText + "</p>";
      submittedAnswersContainer.appendChild(newAnswer);

      // Retrieve existing answers from localStorage
      var storedAnswers = localStorage.getItem("answers" + answerId.slice(-1));
      var answers = storedAnswers ? JSON.parse(storedAnswers) : [];
      answers.push(answerText);

      // Store the answers in localStorage
      localStorage.setItem("answers" + answerId.slice(-1), JSON.stringify(answers));
      
      // Clear the textarea after submitting the answer
      document.querySelector("#" + answerId + " textarea").value = "";
    }

    // Function to delete an answer
    function deleteAnswer(answerId) {
      var answerContainer = document.getElementById(answerId);
      answerContainer.parentNode.removeChild(answerContainer);

      // Remove the answer from localStorage
      var questionNumber = answerId.slice(-1);
      var storedAnswers = localStorage.getItem("answers" + questionNumber);
      if (storedAnswers) {
        var answers = JSON.parse(storedAnswers);
        answers.splice(answers.indexOf(answerId), 1);
        localStorage.setItem("answers" + questionNumber, JSON.stringify(answers));
      }
    }
  
    //toggle pin
    function togglePin(questionId) {
        var pinIcon = document.getElementById("pinIcon_" + questionId);
        pinIcon.classList.toggle("fa-thumbtack");
        pinIcon.classList.toggle("fa-thumbtack-o");
        var questionCard = document.getElementById("question" + questionId.slice(-1));
        questionCard.classList.toggle("pinned");
        var pinnedMsg = questionCard.querySelector(".pinned-msg");
        if (questionCard.classList.contains("pinned")) {
            if (!pinnedMsg) {
                pinnedMsg = document.createElement("small");
                pinnedMsg.classList.add("text-muted", "ml-2", "pinned-msg");
                pinnedMsg.textContent = "Pinned";
                questionCard.appendChild(pinnedMsg);
            }
            // Store the pinned state 
            localStorage.setItem(questionId, "pinned");
        } else {
            if (pinnedMsg) {
                questionCard.removeChild(pinnedMsg);
            }
            // unpinned  
            localStorage.removeItem(questionId);
        }
        sortQuestions();
    }

    // Function to sort the questions based on pinned status
    function sortQuestions() {
        var questionCards = document.querySelectorAll('.question-card');

        // array to store pinned and unpinned question 
        var pinnedQuestions = [];
        var unpinnedQuestions = [];

        // Separate pinned and unpinned question 
        questionCards.forEach(function(card) {
            if (card.classList.contains('pinned')) {
                pinnedQuestions.push(card);
            } else {
                unpinnedQuestions.push(card);
            }
        });

        var container = document.querySelector('.col-md-8');
        container.innerHTML = '';

        pinnedQuestions.forEach(function(card) {
            container.appendChild(card);
        });

        unpinnedQuestions.forEach(function(card) {
            container.appendChild(card);
        });
    }


  </script> 
{% endblock %}