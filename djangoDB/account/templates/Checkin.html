{%extends 'base.html'%}
{% load static %}
{% block content %}
    <title>Interactive Calendar</title>
    <!-- Checkin Content -->
    <div id="rightsidebar"></div>
    <div id="history"></div>
    <!-- Scripts -->
    <script>
        function createCalendar() {
            // current date
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            const currentDay = currentDate.getDate();

            // first day of the current month
            const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
            // number of days in the current month
            const numberOfDaysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            // Month 
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

            // calendar header
            const calendarHeader = `<div class="calendar-header">${monthNames[currentMonth]} ${currentYear}</div>`;

            // calendar table
            let calendarTable = '<table class="calendar">';
            calendarTable += '<thead><tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr></thead>';
            calendarTable += '<tbody>';

            // keep track of the day of the week
            let dayOfWeek = firstDayOfMonth.getDay();

            // fill the days of the previous month if necessary to complete the first week
            calendarTable += '<tr>';
            for (let i = 0; i < dayOfWeek; i++) {
                calendarTable += '<td></td>';
            }

            // calendar days
            for (let i = 1; i <= numberOfDaysInMonth; i++) {
                if (i === currentDay) {
                    calendarTable += `<td class="current-day">${i}</td>`;
                } else {
                    calendarTable += `<td>${i}</td>`;
                }
                dayOfWeek++;
                if (dayOfWeek === 7) {
                    calendarTable += '</tr><tr>';
                    dayOfWeek = 0;
                }
            }

            // fill the days of the next month if necessary to complete the last week
            if (dayOfWeek > 0) {
                for (let i = dayOfWeek; i < 7; i++) {
                    calendarTable += '<td></td>';
                }
            }

            calendarTable += '</tr></tbody></table>';

            // combine header and table and append to sidebar
            const calendarContainer = document.createElement('div');
            calendarContainer.classList.add('calendar-container');
            calendarContainer.innerHTML = calendarHeader + calendarTable;

            document.getElementById('rightsidebar').appendChild(calendarContainer);

            // Track checked-in days
            const checkedInDays = new Map();

            //  event listener for each day for check-in
            const days = calendarContainer.querySelectorAll('td');
            days.forEach(day => {
                day.addEventListener('click', () => {
                    // Check if the day is the present day
                    if (parseInt(day.textContent) === currentDay) {
                        // Check if the day is already checked in
                        if (checkedInDays.has(day.textContent)) {
                            console.log(`Already checked in on day ${day.textContent}`);
                            alert(`You have already checked in on day ${day.textContent}.`);
                        } else {
                            // Toggle checked-in status
                            day.classList.add('checked-in');
                            checkedInDays.set(day.textContent, new Date());
                            // Log the checked-in status (for demonstration)
                            console.log(`Checked in on day ${day.textContent}`);
                            alert(`You have checked in on day ${day.textContent}.`);
                            updateHistory(checkedInDays);
                        }
                    } else {
                        // Show alert if trying to check in on a different day
                        alert(`You can only check in on the current day.`);
                    }
                });
            });
        }

        function updateHistory(checkedInDays) {
            const historyContainer = document.getElementById('history');
            historyContainer.innerHTML = ''; // Clear previous history

            const historyHeader = document.createElement('div');
            historyHeader.classList.add('history-header');
            historyHeader.textContent = 'Checked-in History:';
            historyContainer.appendChild(historyHeader);

            const historyList = document.createElement('ul');
            historyList.classList.add('history-list');

            checkedInDays.forEach((date, day) => {
                const historyItem = document.createElement('li');
                historyItem.classList.add('history-item');
                const formattedDate = formatDate(date);
                historyItem.textContent = `${formattedDate}`;
                historyList.appendChild(historyItem);
            });

            historyContainer.appendChild(historyList);
        }

        function formatDate(date) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // generate calendar
        createCalendar();
    </script>
{% endblock %}